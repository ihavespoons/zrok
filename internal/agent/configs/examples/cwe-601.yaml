cwe: CWE-601
name: URL Redirection to Untrusted Site
examples:
  - language: go
    vulnerable: |
      func loginCallback(w http.ResponseWriter, r *http.Request) {
          redirectURL := r.URL.Query().Get("redirect")
          http.Redirect(w, r, redirectURL, http.StatusFound)
      }
    patched: |
      var allowedRedirects = map[string]bool{"/dashboard": true, "/profile": true}

      func loginCallback(w http.ResponseWriter, r *http.Request) {
          redirectURL := r.URL.Query().Get("redirect")
          if !allowedRedirects[redirectURL] {
              redirectURL = "/dashboard"
          }
          http.Redirect(w, r, redirectURL, http.StatusFound)
      }
    explanation: "Open redirect from user input vs allowlist of valid redirect targets"
  - language: javascript
    vulnerable: |
      app.get('/redirect', (req, res) => {
        res.redirect(req.query.url);
      });
    patched: |
      app.get('/redirect', (req, res) => {
        const url = new URL(req.query.url, 'https://example.com');
        if (url.origin !== 'https://example.com') {
          return res.status(400).send('Invalid redirect');
        }
        res.redirect(url.pathname);
      });
    explanation: "Unvalidated redirect vs origin check ensuring same-site redirect"
